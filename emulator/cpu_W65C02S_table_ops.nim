

# W65C02S and R65C02 use the same set of instructions except the W65C02S has
# WAI and STP.  The WAI instruction was added for improved interrupt response
# time and low power.  The STP instruction can help to conserve power in
# current designs.

#[
type
  opcode_65xxx = tuple
    id    : int
    name  : Opcode
    mode  : AddressMode
    size  : int
    cycles: int
    d     : int
    p     : int
]#

const op_table : opArr = [
    (0x00, BRK, PC_Relative         , 1, 7, 0, 0),
    (0x01, ORA, ZP_X_Indirect       , 2, 6, 0, 0),
    (0x02, ILL, Implied             , 2, 2, 0, 0),
    (0x03, ILL, Implied             , 1, 1, 0, 0),
    (0x04, TSB, ZP                  , 2, 5, 0, 0),
    (0x05, ORA, ZP                  , 2, 3, 0, 0),
    (0x06, ASL, ZP                  , 2, 5, 0, 0),
    (0x07, RMB, ZP                  , 2, 5, 0, 0),
    (0x08, PHP, Implied             , 1, 3, 0, 0),
    (0x09, ORA, Immediate           , 2, 2, 0, 0),
    (0x0A, ASL, Accumulator         , 1, 2, 0, 0),
    (0x0B, ILL, Implied             , 1, 1, 0, 0),
    (0x0C, TSB, Absolute            , 3, 6, 0, 0),
    (0x0D, ORA, Absolute            , 3, 4, 0, 0),
    (0x0E, ASL, Absolute            , 3, 6, 0, 0),
    (0x0F, BBR, ZP_Relative         , 3, 5, 0, 0), # +t+t*p
    (0x10, BPL, PC_Relative         , 2, 2, 0, 0), # +t+t*p
    (0x11, ORA, ZP_Indirect_Y       , 2, 5, 0, 1),
    (0x12, ORA, ZP_Indirect         , 2, 5, 0, 0),
    (0x13, ILL, Implied             , 1, 1, 0, 0),
    (0x14, TRB, ZP                  , 2, 5, 0, 0),
    (0x15, ORA, ZP_X                , 2, 4, 0, 0),
    (0x16, ASL, ZP_X                , 2, 6, 0, 0),
    (0x17, RMB, ZP                  , 2, 5, 0, 0),
    (0x18, CLC, Implied             , 1, 2, 0, 0),
    (0x19, ORA, Absolute_Y          , 3, 4, 0, 1),
    (0x1A, INC, Implied             , 1, 2, 0, 0),
    (0x1B, ILL, Implied             , 1, 1, 0, 0),
    (0x1C, TRB, Absolute            , 3, 6, 0, 0),
    (0x1D, ORA, Absolute_X          , 3, 4, 0, 1),
    (0x1E, ASL, Absolute_X          , 3, 6, 0, 1),
    (0x1F, BBR, ZP_Relative         , 3, 5, 0, 0), # +t+t*p
    (0x20, JSR, Absolute            , 3, 6, 0, 0),
    (0x21, AND, ZP_X_Indirect       , 2, 6, 0, 0),
    (0x22, ILL, Implied             , 2, 2, 0, 0),
    (0x23, ILL, Implied             , 1, 1, 0, 0),
    (0x24, BIT, ZP                  , 2, 3, 0, 0),
    (0x25, AND, ZP                  , 2, 3, 0, 0),
    (0x26, ROL, ZP                  , 2, 5, 0, 0),
    (0x27, RMB, ZP                  , 2, 5, 0, 0),
    (0x28, PLP, Implied             , 1, 4, 0, 0),
    (0x29, AND, Immediate           , 2, 2, 0, 0),
    (0x2A, ROL, Accumulator         , 1, 2, 0, 0),
    (0x2B, ILL, Implied             , 1, 1, 0, 0),
    (0x2C, BIT, Absolute            , 3, 4, 0, 0),
    (0x2D, AND, Absolute            , 3, 4, 0, 0),
    (0x2E, ROL, Absolute            , 3, 6, 0, 0),
    (0x2F, BBR, ZP_Relative         , 3, 5, 0, 0), # +t+t*p
    (0x30, BMI, PC_Relative         , 2, 2, 0, 0), # +t+t*p
    (0x31, AND, ZP_Indirect_Y       , 2, 5, 0, 1),
    (0x32, AND, ZP_Indirect         , 2, 5, 0, 0),
    (0x33, ILL, Implied             , 1, 1, 0, 0),
    (0x34, BIT, ZP_X                , 2, 4, 0, 0),
    (0x35, AND, ZP_X                , 2, 4, 0, 0),
    (0x36, ROL, ZP_X                , 2, 6, 0, 0),
    (0x37, RMB, ZP                  , 2, 5, 0, 0),
    (0x38, SEC, Implied             , 1, 2, 0, 0),
    (0x39, AND, Absolute_Y          , 3, 4, 0, 1),
    (0x3A, DEC, Implied             , 1, 2, 0, 0),
    (0x3B, ILL, Implied             , 1, 1, 0, 0),
    (0x3C, BIT, Absolute_X          , 3, 4, 0, 1),
    (0x3D, AND, Absolute_X          , 3, 4, 0, 1),
    (0x3E, ROL, Absolute_X          , 3, 6, 0, 1),
    (0x3F, BBR, ZP_Relative         , 3, 5, 0, 0), # +t+t*p
    (0x40, RTI, Implied             , 1, 6, 0, 0),
    (0x41, EOR, ZP_X_Indirect       , 2, 6, 0, 0),
    (0x42, ILL, Implied             , 2, 2, 0, 0),
    (0x43, ILL, Implied             , 1, 1, 0, 0),
    (0x44, ILL, Implied             , 2, 3, 0, 0),
    (0x45, EOR, ZP                  , 2, 3, 0, 0),
    (0x46, LSR, ZP                  , 2, 5, 0, 0),
    (0x47, RMB, ZP                  , 2, 5, 0, 0),
    (0x48, PHA, Implied             , 1, 3, 0, 0),
    (0x49, EOR, Immediate           , 2, 2, 0, 0),
    (0x4A, LSR, Accumulator         , 1, 2, 0, 0),
    (0x4B, ILL, Implied             , 1, 1, 0, 0),
    (0x4C, JMP, Absolute            , 3, 3, 0, 0),
    (0x4D, EOR, Absolute            , 3, 4, 0, 0),
    (0x4E, LSR, Absolute            , 3, 6, 0, 0),
    (0x4F, BBR, ZP_Relative         , 3, 5, 0, 0), # +t+t*p
    (0x50, BVC, PC_Relative         , 2, 2, 0, 0), # +t+t*p
    (0x51, EOR, ZP_Indirect_Y       , 2, 5, 0, 1),
    (0x52, EOR, ZP_Indirect         , 2, 5, 0, 0),
    (0x53, ILL, Implied             , 1, 1, 0, 0),
    (0x54, ILL, Implied             , 2, 4, 0, 0),
    (0x55, EOR, ZP_X                , 2, 4, 0, 0),
    (0x56, LSR, ZP_X                , 2, 6, 0, 0),
    (0x57, RMB, ZP                  , 2, 5, 0, 0),
    (0x58, CLI, Implied             , 1, 2, 0, 0),
    (0x59, EOR, Absolute_Y          , 3, 4, 0, 1),
    (0x5A, PHY, Implied             , 1, 3, 0, 0),
    (0x5B, ILL, Implied             , 1, 1, 0, 0),
    (0x5C, ILL, Implied             , 3, 8, 0, 0),
    (0x5D, EOR, Absolute_X          , 3, 4, 0, 1),
    (0x5E, LSR, Absolute_X          , 3, 6, 0, 1),
    (0x5F, BBR, ZP_Relative         , 3, 5, 0, 0), # +t+t*p
    (0x60, RTS, Implied             , 1, 6, 0, 0),
    (0x61, ADC, ZP_X_Indirect       , 2, 6, 1, 0),
    (0x62, ILL, Implied             , 2, 2, 0, 0),
    (0x63, ILL, Implied             , 1, 1, 0, 0),
    (0x64, STZ, ZP                  , 2, 3, 0, 0),
    (0x65, ADC, ZP                  , 2, 3, 1, 0),
    (0x66, ROR, ZP                  , 2, 5, 0, 0),
    (0x67, RMB, ZP                  , 2, 5, 0, 0),
    (0x68, PLA, Implied             , 1, 4, 0, 0),
    (0x69, ADC, Immediate           , 2, 2, 1, 0),
    (0x6A, ROR, Accumulator         , 1, 2, 0, 0),
    (0x6B, ILL, Implied             , 1, 1, 0, 0),
    (0x6C, JMP, Absolute_Indirect   , 3, 5, 0, 0),
    (0x6D, ADC, Absolute            , 3, 4, 1, 0),
    (0x6E, ROR, Absolute            , 3, 6, 0, 0),
    (0x6F, BBR, ZP_Relative         , 3, 5, 0, 0), # +t+t*p
    (0x70, BVS, PC_Relative         , 2, 2, 0, 0), # +t+t*p
    (0x71, ADC, ZP_Indirect_Y       , 2, 5, 1, 1),
    (0x72, ADC, ZP_Indirect         , 2, 5, 1, 0),
    (0x73, ILL, Implied             , 1, 1, 0, 0),
    (0x74, STZ, ZP_X                , 2, 4, 0, 0),
    (0x75, ADC, ZP_X                , 2, 4, 1, 0),
    (0x76, ROR, ZP_X                , 2, 6, 0, 0),
    (0x77, RMB, ZP                  , 2, 5, 0, 0),
    (0x78, SEI, Implied             , 1, 2, 0, 0),
    (0x79, ADC, Absolute_Y          , 3, 4, 1, 1),
    (0x7A, PLY, Implied             , 1, 4, 0, 0),
    (0x7B, ILL, Implied             , 1, 1, 0, 0),
    (0x7C, JMP, Absolute_X_Indirect , 3, 6, 0, 0),
    (0x7D, ADC, Absolute_X          , 3, 4, 1, 1),
    (0x7E, ROR, Absolute_X          , 3, 6, 0, 1),
    (0x7F, BBR, ZP_Relative         , 3, 5, 0, 0), # +t+t*p
    (0x80, BRA, Implied             , 2, 3, 0, 0),
    (0x81, STA, ZP_X_Indirect       , 2, 6, 0, 0),
    (0x82, ILL, Implied             , 2, 2, 0, 0),
    (0x83, ILL, Implied             , 1, 1, 0, 0),
    (0x84, STY, ZP                  , 2, 3, 0, 0),
    (0x85, STA, ZP                  , 2, 3, 0, 0),
    (0x86, STX, ZP                  , 2, 3, 0, 0),
    (0x87, SMB, ZP                  , 2, 5, 0, 0),
    (0x88, DEY, Implied             , 1, 2, 0, 0),
    (0x89, BIT, Immediate           , 2, 2, 0, 0),
    (0x8A, TXA, Implied             , 1, 2, 0, 0),
    (0x8B, ILL, Implied             , 1, 1, 0, 0),
    (0x8C, STY, Absolute            , 3, 4, 0, 0),
    (0x8D, STA, Absolute            , 3, 4, 0, 0),
    (0x8E, STX, Absolute            , 3, 4, 0, 0),
    (0x8F, BBS, ZP_Relative         , 3, 5, 0, 0), # +t+t*p
    (0x90, BCC, PC_Relative         , 2, 2, 0, 0), # +t+t*p
    (0x91, STA, ZP_Indirect_Y       , 2, 6, 0, 0),
    (0x92, STA, ZP_Indirect         , 2, 5, 0, 0),
    (0x93, ILL, Implied             , 1, 1, 0, 0),
    (0x94, STY, ZP_X                , 2, 4, 0, 0),
    (0x95, STA, ZP_X                , 2, 4, 0, 0),
    (0x96, STX, ZP_Y                , 2, 4, 0, 0),
    (0x97, SMB, ZP                  , 2, 5, 0, 0),
    (0x98, TYA, Implied             , 1, 2, 0, 0),
    (0x99, STA, Absolute_Y          , 3, 5, 0, 0),
    (0x9A, TXS, Implied             , 1, 2, 0, 0),
    (0x9B, ILL, Implied             , 1, 1, 0, 0),
    (0x9C, STZ, Absolute            , 3, 4, 0, 0),
    (0x9D, STA, Absolute_X          , 3, 5, 0, 0),
    (0x9E, STZ, Absolute_X          , 3, 5, 0, 0),
    (0x9F, BBS, ZP_Relative         , 3, 5, 0, 0), # +t+t*p
    (0xA0, LDY, Immediate           , 2, 2, 0, 0),
    (0xA1, LDA, ZP_X_Indirect       , 2, 6, 0, 0),
    (0xA2, LDX, Immediate           , 2, 2, 0, 0),
    (0xA3, ILL, Implied             , 1, 1, 0, 0),
    (0xA4, LDY, ZP                  , 2, 3, 0, 0),
    (0xA5, LDA, ZP                  , 2, 3, 0, 0),
    (0xA6, LDX, ZP                  , 2, 3, 0, 0),
    (0xA7, SMB, ZP                  , 2, 5, 0, 0),
    (0xA8, TAY, Implied             , 1, 2, 0, 0),
    (0xA9, LDA, Immediate           , 2, 2, 0, 0),
    (0xAA, TAX, Implied             , 1, 2, 0, 0),
    (0xAB, ILL, Implied             , 1, 1, 0, 0),
    (0xAC, LDY, Absolute            , 3, 4, 0, 0),
    (0xAD, LDA, Absolute            , 3, 4, 0, 0),
    (0xAE, LDX, Absolute            , 3, 4, 0, 0),
    (0xAF, BBS, ZP_Relative         , 3, 5, 0, 0), # +t+t*p
    (0xB0, BCS, PC_Relative         , 2, 2, 0, 0), # +t+t*p
    (0xB1, LDA, ZP_Indirect_Y       , 2, 5, 0, 1),
    (0xB2, LDA, ZP_Indirect         , 2, 5, 0, 0),
    (0xB3, ILL, Implied             , 1, 1, 0, 0),
    (0xB4, LDY, ZP_X                , 2, 4, 0, 0),
    (0xB5, LDA, ZP_X                , 2, 4, 0, 0),
    (0xB6, LDX, ZP_Y                , 2, 4, 0, 0),
    (0xB7, SMB, ZP                  , 2, 5, 0, 0),
    (0xB8, CLV, Implied             , 1, 2, 0, 0),
    (0xB9, LDA, Absolute_Y          , 3, 4, 0, 1),
    (0xBA, TSX, Implied             , 1, 2, 0, 0),
    (0xBB, ILL, Implied             , 1, 1, 0, 0),
    (0xBC, LDY, Absolute_X          , 3, 4, 0, 1),
    (0xBD, LDA, Absolute_X          , 3, 4, 0, 1),
    (0xBE, LDX, Absolute_Y          , 3, 4, 0, 1),
    (0xBF, BBS, ZP_Relative         , 3, 5, 0, 0), # +t+t*p
    (0xC0, CPY, Immediate           , 2, 2, 0, 0),
    (0xC1, CMP, ZP_X_Indirect       , 2, 6, 0, 0),
    (0xC2, ILL, Implied             , 2, 2, 0, 0),
    (0xC3, ILL, Implied             , 1, 1, 0, 0),
    (0xC4, CPY, ZP                  , 2, 3, 0, 0),
    (0xC5, CMP, ZP                  , 2, 3, 0, 0),
    (0xC6, DEC, ZP                  , 2, 5, 0, 0),
    (0xC7, SMB, ZP                  , 2, 5, 0, 0),
    (0xC8, INY, Implied             , 1, 2, 0, 0),
    (0xC9, CMP, Immediate           , 2, 2, 0, 0),
    (0xCA, DEX, Implied             , 1, 2, 0, 0),
    (0xCB, WAI, Implied             , 1, 2, 0, 0),
    (0xCC, CPY, Absolute            , 3, 4, 0, 0),
    (0xCD, CMP, Absolute            , 3, 4, 0, 0),
    (0xCE, DEC, Absolute            , 3, 6, 0, 0),
    (0xCF, BBS, ZP_Relative         , 3, 5, 0, 0), # +t+t*p
    (0xD0, BNE, PC_Relative         , 2, 2, 0, 0), # +t+t*p
    (0xD1, CMP, ZP_Indirect_Y       , 2, 5, 0, 1),
    (0xD2, CMP, ZP_Indirect         , 2, 5, 0, 0),
    (0xD3, ILL, Implied             , 1, 1, 0, 0),
    (0xD4, ILL, Implied             , 2, 4, 0, 0),
    (0xD5, CMP, ZP_X                , 2, 4, 0, 0),
    (0xD6, DEC, ZP_X                , 2, 6, 0, 0),
    (0xD7, SMB, ZP                  , 2, 5, 0, 0),
    (0xD8, CLD, Implied             , 1, 2, 0, 0),
    (0xD9, CMP, Absolute_Y          , 3, 4, 0, 1),
    (0xDA, PHX, Implied             , 1, 3, 0, 0),
    (0xDB, STP, Implied             , 1, 3, 0, 0),
    (0xDC, ILL, Implied             , 3, 4, 0, 0),
    (0xDD, CMP, Absolute_X          , 3, 4, 0, 1),
    (0xDE, DEC, Absolute_X          , 3, 7, 0, 0),
    (0xDF, BBS, ZP_Relative         , 3, 5, 0, 0), # +t+t*p
    (0xE0, CPX, Immediate           , 2, 2, 0, 0),
    (0xE1, SBC, ZP_X_Indirect       , 2, 6, 1, 0),
    (0xE2, ILL, Implied             , 2, 2, 0, 0),
    (0xE3, ILL, Implied             , 1, 1, 0, 0),
    (0xE4, CPX, ZP                  , 2, 3, 0, 0),
    (0xE5, SBC, ZP                  , 2, 3, 1, 0),
    (0xE6, INC, ZP                  , 2, 5, 0, 0),
    (0xE7, SMB, ZP                  , 2, 5, 0, 0),
    (0xE8, INX, Implied             , 1, 2, 0, 0),
    (0xE9, SBC, Immediate           , 2, 2, 1, 0),
    (0xEA, NOP, Implied             , 1, 2, 0, 0),
    (0xEB, ILL, Implied             , 1, 1, 0, 0),
    (0xEC, CPX, Absolute            , 3, 4, 0, 0),
    (0xED, SBC, Absolute            , 3, 4, 1, 0),
    (0xEE, INC, Absolute            , 3, 6, 0, 0),
    (0xEF, BBS, ZP_Relative         , 3, 5, 0, 0), # +t+t*p
    (0xF0, BEQ, PC_Relative         , 2, 2, 0, 0), # +t+t*p
    (0xF1, SBC, ZP_Indirect_Y       , 2, 5, 1, 1),
    (0xF2, SBC, ZP_Indirect         , 2, 5, 1, 0),
    (0xF3, ILL, Implied             , 1, 1, 0, 0),
    (0xF4, ILL, Implied             , 2, 4, 0, 0),
    (0xF5, SBC, ZP_X                , 2, 4, 1, 0),
    (0xF6, INC, ZP_X                , 2, 6, 0, 0),
    (0xF7, SMB, ZP                  , 2, 5, 0, 0),
    (0xF8, SED, Implied             , 1, 2, 0, 0),
    (0xF9, SBC, Absolute_Y          , 3, 4, 1, 1),
    (0xFA, PLX, Implied             , 1, 4, 0, 0),
    (0xFB, ILL, Implied             , 1, 1, 0, 0),
    (0xFC, ILL, Implied             , 3, 4, 0, 0),
    (0xFD, SBC, Absolute_X          , 3, 4, 1, 1),
    (0xFE, INC, Absolute_X          , 3, 7, 0, 0),
    (0xFF, BBS, ZP_Relative         , 3, 5, 0, 0), # +t+t*p
]
